<source>
@type forward
</source>

<filter docker.core.**>
@type parser
format json
key_name log
time_format %Y-%m-%dT%H:%M:%S%z
</filter>

<match docker.**>
@type stdout
</match>

<match docker.**>
@type s3
aws_key_id ***REMOVED***
aws_sec_key ***REMOVED***
s3_bucket uct.logs
s3_region us-east-1
path logs
buffer_path /fluentd/logs/
store_as json
format json
include_time_key true
time_key time
include_tag_key true

time_slice_format %Y%m%d%H%M
time_slice_wait 1m

utc
</match>

<match docker.influxdb>
@type cloudwatch_logs
region us-east-1
aws_key_id ***REMOVED***
aws_sec_key ***REMOVED***
log_group_name uct.logs
auto_create_stream true
#message_keys key1,key2,key3,...
#max_message_length 32768
#use_tag_as_group false
use_tag_as_stream true
include_time_key true
#localtime true
#log_group_name_key group_name_key
#log_stream_name_key stream_name_key
#remove_log_group_name_key true
#remove_log_stream_name_key true
#put_log_events_retry_wait 1s
#put_log_events_retry_limit 17
#put_log_events_disable_retry_limit false
</match>

<match docker.**>
@type forest
subtype s3
remove_prefix docker

<template>
aws_key_id ***REMOVED***
aws_sec_key ***REMOVED***
s3_bucket uct.docker.logs
s3_region us-east-1
path forest
buffer_path /fluentd/logs/__TAG__/
s3_object_key_format %{path}/%{tag}/%{time_slice}_%{index}.%{file_extension}
store_as json
format json
include_time_key true
time_key time
include_tag_key true

time_slice_format %Y%m%d%H%M
time_slice_wait 1m

utc
</template>

</match>
